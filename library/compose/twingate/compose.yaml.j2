services:
  {{ service_name }}:
    image: docker.io/twingate/connector:{{ twingate_version }}
    restart: {{ restart_policy }}
    container_name: {{ container_name }}

    hostname: {{ container_hostname }}
    {#
      Environment variables for Twingate Connector configuration
      - TZ: Timezone
      - TWINGATE_NETWORK: Your Twingate network name
      - TWINGATE_ACCESS_TOKEN: Access token (from env or secret)
      - TWINGATE_REFRESH_TOKEN: Refresh token (from env or secret)
      - TWINGATE_LOG_LEVEL: Log verbosity level
      - TWINGATE_DNS: Optional local DNS server override
    #}
    environment:
      - TZ={{ container_timezone }}
      - TWINGATE_NETWORK={{ twingate_network }}
      - TWINGATE_ACCESS_TOKEN=${TWINGATE_ACCESS_TOKEN:?error}
      - TWINGATE_REFRESH_TOKEN=${TWINGATE_REFRESH_TOKEN:?error}
      - TWINGATE_LOG_LEVEL={{ twingate_log_level }}
      {% if twingate_dns %}
      - TWINGATE_DNS={{ twingate_dns }}
      {% endif %}
    {#
      Required sysctls for Twingate connector networking
    #}
    sysctls:
      net.ipv4.ping_group_range: "0 2147483647"

networks:
    {{ network_name }}:
        external: true
